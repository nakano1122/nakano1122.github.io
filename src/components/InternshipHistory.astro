---
import { readFileSync } from 'fs';
import { join } from 'path';

// Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥èª­ã¿è¾¼ã¿
const internshipHistoryPath = join(process.cwd(), 'src/data/internship-history.md');
const markdownContent = readFileSync(internshipHistoryPath, 'utf-8');

// ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã«ãƒ‘ãƒ¼ã‚¹
function parseInternshipMarkdown(content: string) {
	const internships = [];
	
	// ## ã§åˆ†å‰²ã—ã¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—
	const sections = content.split('## ').filter(section => section.trim());
	
	sections.forEach(section => {
		if (section.match(/^\d+\./)) {
			const lines = section.split('\n');
			
			// ä¼šç¤¾åã‚’æŠ½å‡º
			const titleMatch = lines[0].match(/\d+\.\s*(.*?)\s*\(/);
			const company = titleMatch ? titleMatch[1].trim() : '';
			
			// æœŸé–“ã‚’æŠ½å‡º
			const periodMatch = lines[0].match(/\((.*?)\)/);
			const period = periodMatch ? periodMatch[1] : '';
			
			// éƒ¨ç½²ã‚’æŠ½å‡º
			let department = '';
			let description = [];
			
			lines.forEach(line => {
				if (line.includes('**éƒ¨ç½²**:')) {
					department = line.replace('**éƒ¨ç½²**:', '').replace('-', '').trim();
				}
				if (line.includes('**æ¥­å‹™å†…å®¹**:')) {
					// æ¥­å‹™å†…å®¹ã®æ¬¡ã®è¡Œã‹ã‚‰èª¬æ˜ã‚’æŠ½å‡º
					const startIndex = lines.indexOf(line);
					for (let i = startIndex + 1; i < lines.length; i++) {
						const descLine = lines[i].trim();
						if (descLine.startsWith('-')) {
							description.push(descLine.replace('-', '').trim());
						} else if (descLine === '') {
							continue;
						} else {
							break;
						}
					}
				}
			});
			
			if (company) {
				internships.push({
					company,
					role: department.includes('Backend') ? 'Backend Engineer Intern' : 
					       department.includes('AI') ? 'AI Engineer Intern' :
					       department.includes('Frontend') ? 'Frontend Engineer Intern' : 'Software Engineer Intern',
					duration: period.includes('ç¾åœ¨') ? 'é€²è¡Œä¸­' : '2ãƒ¶æœˆé–“',
					period,
					department,
					description: description.length > 0 ? description : ['æ¥­å‹™å†…å®¹ã®è©³ç´°'],
					technologies: ['Next.js', 'Django', 'Python', 'Webé–‹ç™º'],
					status: period.includes('ç¾åœ¨') ? 'ongoing' : 'completed'
				});
			}
		}
	});
	
	return internships;
}

const internships = parseInternshipMarkdown(markdownContent);

const finalInternships = internships;

const getStatusColor = (status: string) => {
	switch (status) {
		case 'completed': return 'var(--color-success)';
		case 'ongoing': return 'var(--color-warning)';
		case 'upcoming': return 'var(--color-accent-solid)';
		default: return 'var(--color-text-light)';
	}
};

const getStatusLabel = (status: string) => {
	switch (status) {
		case 'completed': return 'å®Œäº†';
		case 'ongoing': return 'é€²è¡Œä¸­';
		case 'upcoming': return 'äºˆå®š';
		default: return status;
	}
};

const getStatusIcon = (status: string) => {
	switch (status) {
		case 'completed': return 'âœ…';
		case 'ongoing': return 'ğŸ”„';
		case 'upcoming': return 'ğŸ“…';
		default: return 'ğŸ’¼';
	}
};
---

<section class="internship-history section">
	<div class="container">
		<h2 class="section-title">Internship Experience</h2>
		
		<div class="internship-intro animate-slide-up">
			<div class="intro-content">
				<h3 class="intro-title">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚·ãƒƒãƒ—çµŒé¨“</h3>
				<div class="stats-grid">
					<div class="stat-item">
						<div class="stat-icon">ğŸ¢</div>
						<div class="stat-content">
							<div class="stat-number">{finalInternships.length}</div>
							<div class="stat-label">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³å…ˆä¼æ¥­æ•°</div>
						</div>
					</div>
					<div class="stat-item">
						<div class="stat-icon">â±ï¸</div>
						<div class="stat-content">
							<div class="stat-number">{finalInternships.length * 2}</div>
							<div class="stat-label">ç·å®Ÿå‹™çµŒé¨“æœˆæ•°</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		{finalInternships.length > 0 && (
			<div class="internships-timeline">
				{finalInternships.map((internship, index) => (
					<div class="internship-item animate-slide-up" style={`animation-delay: ${index * 0.2}s`}>
						<div class="timeline-connector">
							<div class="timeline-dot" style={`background-color: ${getStatusColor(internship.status)}`}></div>
							{index < finalInternships.length - 1 && <div class="timeline-line"></div>}
						</div>
						
						<div class="internship-card">
							<div class="internship-header">
								<div class="company-info">
									<h3 class="company-name text-gradient">{internship.company}</h3>
									<p class="role-title">{internship.role}</p>
									<div class="department">{internship.department}</div>
								</div>
								<div class="internship-meta">
									<div class="status-badge" style={`background-color: ${getStatusColor(internship.status)}20; color: ${getStatusColor(internship.status)}`}>
										<span class="status-icon">{getStatusIcon(internship.status)}</span>
										{getStatusLabel(internship.status)}
									</div>
									<div class="duration-info">
										<div class="period">{internship.period}</div>
										<div class="duration">{internship.duration}</div>
									</div>
								</div>
							</div>

							<div class="internship-content">
								<div class="description-section">
									<h4 class="content-title">æ¥­å‹™å†…å®¹</h4>
									<ul class="description-list">
										{internship.description.map((item) => (
											<li class="description-item">{item}</li>
										))}
									</ul>
								</div>

								<div class="technologies-section">
									<h4 class="content-title">ä½¿ç”¨æŠ€è¡“</h4>
									<div class="tech-tags">
										{internship.technologies.map((tech) => (
											<span class="tech-tag">{tech}</span>
										))}
									</div>
								</div>

							</div>
						</div>
					</div>
				))}
			</div>
		)}


	</div>
</section>

<style>
	.internship-history {
		background: var(--color-bg);
	}

	.internship-intro {
		margin-bottom: var(--spacing-3xl);
		background: var(--color-bg-card);
		border-radius: var(--radius-xl);
		padding: var(--spacing-2xl);
		box-shadow: var(--shadow-lg);
		border: 1px solid var(--color-border);
		position: relative;
		overflow: hidden;
	}

	.internship-intro::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 4px;
		background: var(--gradient-primary);
	}

	.intro-content {
		text-align: center;
	}

	.intro-title {
		font-size: 1.75rem;
		font-weight: 700;
		margin-bottom: var(--spacing-xl);
		color: var(--color-text);
		background: var(--gradient-primary);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.stats-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
		gap: var(--spacing-lg);
		max-width: 600px;
		margin: 0 auto;
	}

	.stat-item {
		background: var(--color-bg-secondary);
		border-radius: var(--radius-lg);
		padding: var(--spacing-xl);
		display: flex;
		align-items: center;
		gap: var(--spacing-lg);
		transition: transform 0.3s ease, box-shadow 0.3s ease;
		border: 1px solid var(--color-border);
	}

	.stat-item:hover {
		transform: translateY(-2px);
		box-shadow: var(--shadow-lg);
	}

	.stat-icon {
		font-size: 2.5rem;
		padding: var(--spacing-md);
		background: var(--gradient-primary);
		border-radius: var(--radius-md);
		display: flex;
		align-items: center;
		justify-content: center;
		flex-shrink: 0;
		box-shadow: var(--shadow-md);
	}

	.stat-content {
		flex: 1;
		text-align: left;
	}

	.stat-number {
		font-size: 2rem;
		font-weight: 700;
		color: var(--color-text);
		margin-bottom: var(--spacing-xs);
		background: var(--gradient-primary);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.stat-label {
		color: var(--color-text-light);
		font-weight: 500;
		font-size: 0.875rem;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.internships-timeline {
		position: relative;
		margin: 0 auto;
	}

	.internship-item {
		display: flex;
		margin-bottom: var(--spacing-3xl);
		animation: slideUp 0.6s ease-out both;
	}

	.internship-item:last-child {
		margin-bottom: 0;
	}

	.timeline-connector {
		display: flex;
		flex-direction: column;
		align-items: center;
		margin-right: var(--spacing-xl);
		flex-shrink: 0;
	}

	.timeline-dot {
		width: 20px;
		height: 20px;
		border-radius: 50%;
		border: 4px solid var(--color-bg-card);
		box-shadow: var(--shadow-md);
		z-index: 2;
	}

	.timeline-line {
		width: 2px;
		height: 100%;
		background: var(--color-border);
		margin-top: var(--spacing-sm);
		min-height: 80px;
	}

	.internship-card {
		background: var(--color-bg-card);
		border-radius: var(--radius-xl);
		padding: var(--spacing-2xl);
		box-shadow: var(--shadow-lg);
		border: 1px solid var(--color-border);
		flex: 1;
		transition: transform 0.3s ease, box-shadow 0.3s ease;
		position: relative;
		overflow: hidden;
	}

	.internship-card:hover {
		transform: translateY(-4px);
		box-shadow: var(--shadow-xl);
	}

	.internship-card::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 4px;
		background: var(--gradient-primary);
	}

	.internship-header {
		display: flex;
		justify-content: space-between;
		gap: var(--spacing-xl);
		margin-bottom: var(--spacing-2xl);
		padding-bottom: var(--spacing-lg);
		border-bottom: 1px solid var(--color-border);
	}

	.company-info {
		flex: 1;
	}

	.company-name {
		font-size: 1.75rem;
		font-weight: 700;
		margin-bottom: var(--spacing-xs);
	}

	.role-title {
		font-size: 1.25rem;
		color: var(--color-text-light);
		font-weight: 500;
		margin-bottom: var(--spacing-xs);
	}

	.department {
		color: var(--color-text-lighter);
		padding: var(--spacing-xs) var(--spacing-sm);
		background: var(--color-bg-secondary);
		border-radius: var(--radius-sm);
		display: inline-block;
		font-size: 0.875rem;
	}

	.internship-meta {
		display: flex;
		flex-direction: column;
		align-items: flex-end;
		gap: var(--spacing-sm);
	}

	.status-badge {
		display: flex;
		align-items: center;
		gap: var(--spacing-xs);
		padding: var(--spacing-xs) var(--spacing-sm);
		border-radius: var(--radius-md);
		font-size: 0.875rem;
		font-weight: 600;
		white-space: nowrap;
	}

	.status-icon {
		font-size: 1rem;
	}

	.duration-info {
		text-align: right;
	}

	.period {
		font-size: 0.875rem;
		color: var(--color-text-light);
		font-weight: 500;
	}

	.duration {
		font-size: 0.75rem;
		color: var(--color-text-lighter);
	}

	.internship-content {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-xl);
	}

	.content-title {
		font-size: 1.125rem;
		font-weight: 600;
		margin-bottom: var(--spacing-md);
		color: var(--color-text);
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
	}

	.content-title::before {
		content: '';
		width: 4px;
		height: 20px;
		background: var(--gradient-primary);
		border-radius: 2px;
	}

	.description-list {
		list-style: none;
		padding: 0;
		margin: 0;
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
	}

	.description-item {
		padding: var(--spacing-sm) var(--spacing-md);
		background: var(--color-bg-secondary);
		border-radius: var(--radius-md);
		color: var(--color-text-light);
		line-height: 1.6;
		position: relative;
		padding-left: var(--spacing-xl);
	}

	.description-item::before {
		content: 'â–¸';
		position: absolute;
		left: var(--spacing-md);
		color: var(--color-primary-solid);
		font-weight: 600;
	}

	.tech-tags {
		display: flex;
		flex-wrap: wrap;
		gap: var(--spacing-xs);
	}

	.tech-tag {
		padding: var(--spacing-xs) var(--spacing-sm);
		background: var(--gradient-primary);
		color: white;
		border-radius: var(--radius-sm);
		font-size: 0.875rem;
		font-weight: 500;
		transition: transform 0.2s ease;
	}

	.tech-tag:hover {
		transform: scale(1.05);
	}

	.achievements-grid {
		display: flex;
		flex-direction: column;
		gap: var(--spacing-sm);
	}

	.achievement-item {
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
		padding: var(--spacing-sm) var(--spacing-md);
		background: linear-gradient(135deg, var(--color-success) 0%, var(--color-accent-solid) 100%);
		border-radius: var(--radius-md);
		color: white;
		font-weight: 500;
		font-size: 0.875rem;
	}

	.achievement-icon {
		font-size: 1rem;
		flex-shrink: 0;
	}



	/* ãƒãƒ¼ãƒˆPCå¯¾å¿œ */
	@media (max-width: 1024px) {
		.internship-intro {
			padding: var(--spacing-xl);
		}

		.stats-grid {
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: var(--spacing-md);
		}

		.stat-item {
			padding: var(--spacing-lg);
		}

		.internship-card {
			padding: var(--spacing-xl);
		}

		.internship-header {
			gap: var(--spacing-lg);
		}
	}

	/* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå¯¾å¿œ */
	@media (max-width: 768px) {
		.internship-intro {
			padding: var(--spacing-xl);
		}

		.intro-title {
			font-size: 1.5rem;
		}

		.stats-grid {
			grid-template-columns: 1fr;
			gap: var(--spacing-md);
		}

		.stat-item {
			padding: var(--spacing-lg);
			gap: var(--spacing-md);
		}

		.stat-icon {
			font-size: 2rem;
			padding: var(--spacing-sm);
		}

		.stat-number {
			font-size: 1.75rem;
		}

		.timeline-connector {
			margin-right: var(--spacing-md);
		}

		.internship-card {
			padding: var(--spacing-xl);
		}

		.internship-header {
			flex-direction: column;
			gap: var(--spacing-lg);
		}

		.internship-meta {
			align-items: flex-start;
		}

		.duration-info {
			text-align: left;
		}
	}
</style>